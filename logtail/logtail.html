<html>
<head>
<title>logtail: watch multiple log files on multiple machines</title>

</head>

<body>

<center>
<h1><img src="logtail.gif" width=359 height=124 alt="logtail"></h1>
<h3><font color="#0000FF"><em>Watch Multiple Log Files on Multiple Machines</em></font></h3>
</center>

<hr>

<p>

This page describes, in Unix manual page style,
a <a href="http://www.perl.org/">Perl</a> program
<a href="logtail.tar.gz">available for downloading</a> from this site
which allows a system administrator to watch entries, as
they are added, in any number of log files on one or more
machines on a network.  Logs which transfer to new files
are automatically followed, and an option allows translation
of numeric Internet addresses into the corresponding hostnames
where possible.  Log items can be relayed to one or more
other hosts on the network, permitting a machine's local
log files to be monitored there.

<h3>NAME</h3>
     <b>logtail</b> -- Monitor multiple log files on multiple machines

<h3>SYNOPSIS</h3>
     <B>logtail</B> [ <B>-dnqu</B> ] [ <B>-e</B><I>hostname</I> ] [ <B>-l</B>[<I>port</I>] ] [ <B>-p</B><I>interval</I> ]
          [ <B>-r</B><I>time</I> ] [ <B>-s</B><I>time</I> ] [ <B>-t</B><I>port</I> ] [ <B>-v</B><I>level</I> ] [ <B>-w</B><I>cols</I> ]
          <I>logfile</I>...

<h3>DESCRIPTION</h3>
     Long-term survivors in the system administration game know that
     an excellent way to spot little emerging mouselike problems
     before they mature into moose-sized disasters is keeping an eye
     on the various system log files.  In days of yore this was quite
     simple since almost everything of interest went into the master
     Unix logfile and, if a networked system supported the "loghost"
     facility, logs for a number of machines on a network could be
     consolidated onto a single server.

<p>
     As more and more services have come into use, log files have
     proliferated.  Today, an administrator might want to keep an eye
     on:

<p>
<ul>
<li>      Master system log
<li>      FTP transfer log
<li>      Web (HTTP) server access log
<li>      Uninterruptible Power Source (UPS) log
<li>      Network Time Protocol synchronisation log
<li>      Automated backup system log
<li>      Firewall suspicious access log
<li>      Logs from local services such as Speak Freely
              Look Who's Listening and Echo servers
</ul>
<p>

     and various others.  Many of the widely-used dæmons for these
     functions do not use the common Unix log mechanism, insisting
     instead on appending entries to their own private log files.  In
     the case of commercial firewall, backup, and UPS dæmons, source
     code is not usually available, so modifying them to use the
     system log is not an option.

<p>
     When there was a single log file, monitoring it couldn't be
     simpler--just use:

<p>
<pre>
    tail -f /var/adm/messages
</pre>
<p>

     (or whatever the log file is called on your system).  The
     <B>-f</B> option causes <B>tail</B> to start at the end of the
     file and periodically monitor it for growth, printing any
     additions to the file.  Unfortunately, <B>tail</B> only monitors
     a single file, so the only way to watch multiple files is to
     launch separate jobs each running <B>tail</B> on an individual
     file--yuck.  Worse, to prevent log files from growing without
     bound, consuming all available disc space, many programs that
     write logs provide a mechanism, automatic or semi-automatic, to
     periodically cycle the log to a new file, renaming the previous
     log file.  Unfortunately, <B>tail -f</B> does not detect that
     this has happened, and just waits forever at the end of the old
     log, not knowing a new file is now being written.  If servers are
     run on a number of different machines (or you simply want to
     watch Unix log files on all the hosts you're responsible for to
     keep an eye out for developing disc problems, etc.), you would
     then have to <B>rsh</B> copies of <B>tail -f</B> on every machine
     you wanted to monitor, and then make sure the process got
     restarted when a machine rebooted.

<p>
     Enter <B>logtail</B>, which allows you to monitor any number of
     log files on any number of machines (assuming they support Perl
     with networking and use ASCII log files).  Logs from any machine
     can be echoed to as many other machines as you like.  Log files
     are closed and re-opened at a user-defined interval, so cycling
     of log files into new files is followed automatically.

<h3>OPTIONS</h3>

<dl compact>
<dt><B>-d</B>
<dd>Log messages received from other hosts are normally prefixed with
               the hostname followed by a colon, for example,
               ``wombat:''.  Specifying the <B>-</B><B>d</B> option
               causes the full domain name to be shown:
               ``wombat.marsupials.au:''.  If host name lookup on your
               machine does not return full domain names for local
               hosts, this option will have no effect.

<p>
<dt><B>-e</B><I>hostname</I>
<dd>Messages from <I>logfiles</I> on this host are relayed to a copy
               of <B>logtail</B> running on machine <I>hostname</I>.
               If you want to only relay messages, and not also print
               them locally, specify the <B>-q</B> (Quiet) option as
               well.  Messages are sent to the named host on the port
               given by the <B>-t</B> option, defaulting to port 5741
               if no <B>-t</B> option is present.  If no copy of
               <B>logtail</B> is running on <I>hostname</I> and
               listening on the proper port, relayed messages will
               silently go to packet heaven with no indication they're
               being lost.  You can relay to as many other machines as
               you wish by specifying multiple <B>-e</B> options; the
               same port is used for relays to all hosts.

<p>
<dt>   <B>-l</B>[<I>port</I>]
<dd>Listen for messages relayed from other hosts on the specified
               <I>port</I>, or port 5741 if no <I>port</I> is given.
               Note that you must specify the <B>-l</B> option in
               order to receive messages relayed from other hosts;
               otherwise <B>logtail</B> only examines local log files.

<p>
<dt>   <B>-n</B>         
<dd>When the <B>-r</B> option is specified, <B>logtail</B> normally
               uses <B>fork</B> to spawn a child process to perform
               each host name lookup.  This blocks processing of other
               items until the possibly lengthy host name lookup is
               complete.  The very act of creating a large number of
               child processes may itself, however, cause problems on
               certain implementations of Unix.  In particular, some
               systems leak resources when processes are created and
               destroyed which, in time, may bring the system to its
               knees.  The <B>-n</B> option, specified along with the
               <B>-r</B> option, causes <B>logtail</B> to perform host
               lookups in the main process instead of spawning a child
               process for each.  While this may serve as a
               work-around on lightly loaded systems, the forced
               serialisation of lookups and log item processing will
               generally prove intolerable on servers with moderate to
               heavy load.  Conversely, if your accesses are
               exclusively from local machines whose names can be
               looked up rapidly, the <B>-n</B> option may reduce
               overhead by avoiding the creation of processes for
               lookups which can be completed without significant
               delay.

<p>
<dt>   <B>-p</B><I>interval</I>
<dd>To avoid filling up disc drives with huge, ever-growing log files,
               many dæmons periodically, either automatically or at
               the direction of a user, cycle their log files; the
               existing log file is closed and renamed, logging
               continues in a newly created file, and the oldest log
               file is deleted.  When a log file is cycled,
               <B>logtail</B> has no way to directly discover this has
               occurred.  If it continues to watch the old file, it
               will not find entries written into its replacement.  To
               mitigate this situation, <B>logtail</B> periodically
               closes and re-opens the files it monitors.  This allows
               <B>logtail</B> to begin monitoring the new file instead
               of the now-renamed older cycle.  By default
               <B>logtail</B> performs this close and reopen operation
               every 15 minutes.  To change the frequency, specify the
               <B>-p</B><I>interval</I> option with <I>interval</I>
               the desired time in minutes.  Specifying an
               <I>interval</I> of 0 completely disables the close and
               reopen mechanism.  If you know none of the files being
               monitored are ever cycled, this will eliminate the
               overhead of periodically closing and reopening them.

<p>
<dt><B>-q</B>         
<dd>Quiet: don't print log items on the local machine.  If you want to
               relay log items to another host or hosts with the
               <B>-e</B> option but not print them locally, specify
               the <B>-q</B> option.  This makes sense for "headless
               servers" administered from other workstations.  You can
               specify the <B>-q</B> option without the <B>-e</B>
               option, but doing so simply consumes system resources
               while producing no output whatsoever.

<p>
<dt><B>-r</B><I>time</I>     
<dd>When the <B>-r</B> option is specified, <B>logtail</B> attempts to
               replace any sequences which resemble numeric Internet
               addresses (IP addresses) with the corresponding host
               name, looked up with <B>gethostbyaddr</B>.
               For example, an HTTP log item such as:

<p>
<pre>
172.27.151.132 - - [05/Nov/1997:17:05:12 +0100] "GET / HTTP/1.0" 200 2668
</pre>
<p>

               might be translated into:

<p>
<pre>
roswell.area51.af.mil - - [05/Nov/1997:17:05:12 +0100] "GET / HTTP/1.0" 200 2668
</pre>
<p>

               If the host name lookup is unsuccessful, the original
               numeric address remains intact.

<p>
               Host names corresponding to numeric IP addresses are
               saved by <B>logtail</B> in an internal cache so
               multiple accesses from a given host do not require
               repeatedly querying the system's host name lookup
               mechanism.  Entries in the name cache are purged after
               <I>time</I> minutes of inactivity, with 10 minutes the
               default if no <I>time</I> is given.

<p>
               At first glance, this host name lookup may appear to be
               the niftiest single feature of <B>logtail</B>, but
               before you turn it on, ponder carefully the
               consequences for the system running the program.  If,
               for example, you're monitoring the HTTP access log of a
               heavily loaded Web site, the <B>-r</B> option may
               result in thousands, perhaps millions, of calls to
               <B>gethostbyaddr</B> every hour, most of which will
               require multiple Internet accesses to resolve the host
               name from the IP address.  In order to make these
               requests without blocking the processing of other
               items, <B>logtail</B> performs each of these lookups in
               a separate Unix process, but if your system's resolver
               is single-threaded, everything may still grind to a
               halt due to the resolver bottleneck.  Worse, your own
               resolver and those of upstream Internet sites may grow
               to enormous size due to all the requests cluttering up
               its own internal cache.

<p>
               As long as the volume of log items is relatively small
               (say, a couple per minute), and/or the vast majority of
               references are to local hosts whose names can be looked
               up almost instantaneously, the <B>-r</B> option can
               substantially increase the comprehensibility of the
               log.  But if you switch it on while monitoring a
               million-hit-per-day Web site, you're almost certain to
               end up regretting it.

<p>
<dt>   <B>-s</B><I>time</i>
<dd><B>logtail</B> will sleep <I>time</I> seconds between checks for
               growth of the files it's monitoring.  The default, one
               second, is the same used by the <B>-f</B> option of
               <B>tail</B>.  If the files you're monitoring are only
               updated infrequently, a longer sleep time can reduce
               the overhead of running <B>logtail</B>.  If you've
               specified the <B>-l</B> option to listen for messages
               from other hosts, choose a sleep time appropriate for
               the fastest-arriving stream of relayed messages.  If
               the sleep time is too long, relayed messages may be
               lost if the network input queue overflows.

<p>
<dt>   <B>-t</B><I>port</I>     
<dd>Transmit messages relayed to other hosts with the <B>-e</B> option
               on <I>port</I>.  Note that the same port is used to
               relay to all hosts named in <B>-e</B> option
               specifications.  If no <B>-t</B> option is given, the
               default port of 5741 is used.

<p>
<dt>   <B>-u</B>         
<dd>Print how-to-call information and a summary of options.

<p>
<dt>   <B>-v</B><I>level</I>    
<dd>Verbose: print internal debugging information.  You probably won't
               find this interesting unless you're modifying the
               program.  The greater the <I>level</I>, the more
               detailed (and voluminous) the debugging information
               will be.

<p>
<dt>   <B>-w</B><I>cols</I>     
<dd>Wrap output lines at column <I>cols</I>.  By default, lines are
               wrapped at column 79.  A <I>cols</I> specification of 0
               disables line wrapping.  <B>logtail</B> attempts to
               wrap lines so as to preserve their meaning.  Lines are
               broken at white space whenever possible.  If this
               cannot be done (frequently the case in HTTP logs which
               contain lengthy CGI GET requests), an attempt is then
               made to break the line at a comma or ampersand, major
               delimiters in such strings.  Finally, if the line still
               cannot be broken, it is split at a slash or plus sign.
               If none of these delimiters succeeds in breaking the
               line, it is simply output unbroken.  Continuation lines
               are indented to distinguish them from the first line of
               the next log item.

</dl>

<h3>BUGS</h3>
     <B>logtail</B> is a Perl script.  In order to use it, you must
     have Perl installed on your system.  <B>logtail</B> was developed
     using Perl 4.0, patch level 36.

<p>
     If you're running <B>logtail</B> on a non-System V Unix (for
     example, BSD-derived systems such as SunOS 4.x), you may have to
     change the definitions of <B><tt>$AF_INET</tt></B> and
     <B><tt>$SOCK_DGRAM</tt></B> to agree with those in your system's
     <tt>/usr/include/sys/socket.h</tt> file.  Please refer to the
     comments at the beginning of <tt>logtail.pl</tt> which explain this
     in more detail and include a small C program you can run to
     determine the correct settings for your machine.

<p>
     The host name lookup (<B>-r</B> option) and relaying between
     hosts (<B>-e</B> and <B>-l</B> options) make extensive use of
     Unix networking and process control facilities.  They are
     unlikely in the extreme to work on non-Unix systems, at least not
     without a great deal of modification.

<p>
     The <B>-r</B> option, which attempts to translate numeric
     Internet addresses into host names, can cripple a heavily loaded
     system by a flood of name server requests.  Read the discussion
     of whether this option is appropriate to use on your system in
     the <B>OPTIONS</B> section above before enabling it.

<p>
     When <B>logtail</B> begins monitoring a new cycle of a file,
     entries written between the time the file was cycled and the time
     <B>logtail</B> transferred to monitoring it are not printed; only
     subsequently added entries will be seen.  This is deliberate: the
     HTTP log of a busy Web site, for example, can grow to a very
     substantial size in the interval between being cycled and
     <B>logtail</B>'s discovering it.  Processing all the backed up
     items may be very time-consuming, and relaying them to other
     hosts may run into maximum network packet size restrictions which
     would require substantial additional complexity to work around.
     Since <B>logtail</B> is intended to provide an overview of system
     activity, a few overlooked messages on those infrequent occasions
     when files are cycled doesn't seem unreasonable.

<h3>FILES</h3>
     Each of the <I>logfile</I> arguments named on the command  line  is
     monitored for growth and any additional material is printed.
     Output from <B>logtail</B> is written to standard output,  and  may
     be redirected.

<h3>SEE ALSO</h3>
     <B>fork</B>(2), <B>gethostbyaddr</B>(3N), <B>perl</B>(1), <B>rsh</B>(1), <B>tail</B>(1)

<h2><a href="logtail.tar.gz"><img src="/images/icons/file.gif" alt="" align=middle width=40 height=40></a> <a href="logtail.tar.gz">Download logtail.tar.gz</a> (gzipped TAR archive)</h2>

<h3>AUTHOR</h3>
<address>
          <a href="/">John Walker</a>
<br>
          <a href="/">http://www.fourmilab.ch/</a>
</address>

<p>
<blockquote>
     This software is in the public domain.  Permission to use, copy,
     modify, and distribute this software and its documentation for
     any purpose and without fee is hereby granted, without any
     conditions or restrictions.  This software is provided "as is"
     without express or implied warranty.
</blockquote>

<p>
<hr>
<p>
<address>
by <a href="/">John Walker</a><br>
November 7th, 1997
</address>

</body>
</html>
